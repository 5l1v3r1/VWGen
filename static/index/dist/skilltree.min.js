!function(n,t){function i(n){for(var t=n.split("."),i=window,e="",o=0,r=t.length;r>o;o++)e=t[o],i[e]=i[e]||{},i=i[e];return i}function e(n){return n.length>2&&(n=[n.slice(0,n.length-1).join(", "),n[n.length-1]]),n.join(" and ")}t.bindingHandlers.rightClick={init:function(t,i){n(t).on("mousedown",function(n){3==n.which&&i()()}).on("contextmenu",function(n){n.preventDefault()})}},function(n){var i=(n.Calculator=function(n){function e(n){return t.utils.arrayFirst(u.skills(),function(t){return t.id==n})}function o(n){if(n){v=!1,u.newbMode();var i=n.split(l);i[2]&&u.portrait(Number(i[2])),i[3]&&u.avatarName(i[3]);for(var o=i[1],r=[],s=o.split(""),a=0;a<s.length;a++)if(!Number(s[a])){var p=e(s[a].charCodeAt(0)-c);if(p){var d=Number(s[a+1])||1;r.push({skill:p,points:d})}}for(var f=!0;f;)f=!1,t.utils.arrayForEach(r,function(n){!n.wasAllocated&&n.skill.canAddPoints()&&(n.skill.points(Math.min(n.skill.maxPoints,n.points)),n.wasAllocated=!0,f=!0)});v=!0}}function r(){o(d)}function s(n){window.location.hash=n||h}var a=n||{},u=function(){},c=96,l="_",p=a.numPortraits||1;u.isOpen=t.observable(!0),u.open=function(){u.isOpen(!0)},u.close=function(){u.isOpen(!1)},u.toggle=function(){u.isOpen(!u.isOpen())},u.skills=t.observableArray(t.utils.arrayMap(a.skills,function(n){return new i(n,u.skills,a.learnTemplate)})),t.utils.arrayForEach(a.skills,function(n){if(n.dependsOn){var i=e(n.id);t.utils.arrayForEach(n.dependsOn,function(n){var t=e(n);i.dependencies.push(t),t.dependents.push(i)})}}),u.avatarName=t.observable("Your Name"),u.level=t.computed(function(){var n=0;return t.utils.arrayForEach(u.skills(),function(t){n+=t.points()}),n+1}),u.noPointsSpent=t.computed(function(){return!Boolean(t.utils.arrayFirst(u.skills(),function(n){return n.points()>0}))}),u.stats=t.computed(function(){var n=a.defaultStats||{};t.utils.arrayForEach(u.skills(),function(i){var e=i.points();e>0&&t.utils.arrayForEach(i.stats,function(t){var i=n[t.title]||0;i+=t.value*e,n[t.title]=i})});var i=[];for(var e in n)i.push({title:e,value:n[e]});return i}),u.talentSummary=t.computed(function(){var n=[];return t.utils.arrayForEach(u.skills(),function(t){t.hasPoints()&&(n=n.concat(t.talents))}),n.join(", ")}),u.portrait=t.observable(Math.ceil(Math.random()*p)),u.portraitURL=t.computed(function(){return"/static/index/img/portraits/portrait-{n}.jpg".replace("{n}",u.portrait())}),u.choosePreviousPortrait=function(){var n=u.portrait()-1;1>n&&(n=p),u.portrait(n)},u.chooseNextPortrait=function(){var n=u.portrait()+1;n>p&&(n=1),u.portrait(n)},u.newbMode=function(){t.utils.arrayForEach(u.skills(),function(n){n.points(0)})},u.godMode=function(){t.utils.arrayForEach(u.skills(),function(n){n.points(n.maxPoints)})},u.hash=t.computed(function(){var n=[];return t.utils.arrayForEach(u.skills(),function(t){t.hasPoints()&&(n.push(String.fromCharCode(t.id+c)),t.hasMultiplePoints()&&n.push(t.points()))}),["",n.join(""),u.portrait(),u.avatarName()].join(l)});var d,f,h,m,v=!0;u.useHash=function(n){d=n,clearTimeout(f),f=setTimeout(r,50)},u.hash.subscribe(function(n){v&&(h=n,clearTimeout(m),m=setTimeout(s,50))}),$(document).ready(function(){if(window.location.hash){document.getElementById("HH").value = window.location.hash.substr(1)}}),window.onhashchange=function(){u.useHash(window.location.hash.substr(1)),document.getElementById("HH").value=window.location.hash.substr(1)};var k=window.location.hash.substr(1);return u.isOpen(""!=k),u.useHash(k),u},n.Skill=function(n,i,r){var s=n||{},a=function(){};return a.id=s.id||0,a.title=s.title||"Unknown Skill",a.description=s.description,a.maxPoints=s.maxPoints||1,a.points=t.observable(s.points||0),a.links=t.utils.arrayMap(s.links,function(n){return new o(n)}),a.dependencies=t.observableArray([]),a.dependents=t.observableArray([]),a.stats=s.stats||[],a.rankDescriptions=s.rankDescriptions||[],a.talents=s.talents||[],a.hasDependencies=t.computed(function(){return a.dependencies().length>0}),a.dependenciesFulfilled=t.computed(function(){var n=!0;return t.utils.arrayForEach(a.dependencies(),function(t){t.hasPoints()||(n=!1)}),n}),a.dependentsUsed=t.computed(function(){var n=!1;return t.utils.arrayForEach(a.dependents(),function(t){t.hasPoints()&&(n=!0)}),n}),a.hasPoints=t.computed(function(){return a.points()>0}),a.hasMultiplePoints=t.computed(function(){return a.points()>1}),a.hasMaxPoints=t.computed(function(){return a.points()>=a.maxPoints}),a.canAddPoints=t.computed(function(){return a.dependenciesFulfilled()&&!a.hasMaxPoints()}),a.canRemovePoints=t.computed(function(){return a.dependentsUsed()&&a.hasMultiplePoints()||!a.dependentsUsed()&&a.hasPoints()}),a.helpMessage=t.computed(function(){if(!a.dependenciesFulfilled()){var n=[];return t.utils.arrayForEach(a.dependencies(),function(t){t.hasMaxPoints()||n.push(t.title)}),(r||"Learn {n} to unlock.").replace("{n}",e(n))}return""}),a.talentSummary=t.computed(function(){return a.talents.join(", ")}),a.currentRankDescription=t.computed(function(){return a.rankDescriptions[a.points()-1]}),a.nextRankDescription=t.computed(function(){return a.rankDescriptions[a.points()]}),a.addPoint=function(){a.canAddPoints()&&a.points(a.points()+1)},a.removePoint=function(){a.canRemovePoints()&&a.points(a.points()-1)},a}),o=n.Link=function(n){var t=n||{},i=function(){};return i.label=t.label||t.url||"Learn more",i.url=t.url||"javascript:void(0)",i}}(i("tft.skilltree"))}(window.jQuery,window.ko);
